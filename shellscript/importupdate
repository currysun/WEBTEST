#!/bin/bash
export ORACLE_SID=ora11g
#export FROMUSER=FED_SYSTEM_V4
#export FROMUSER=`basename $0`
#echo $USERNAME
#export USERNAME=$FROMUSER
echo "PLEASE INPUT FROMUSER NAME: "
read FROMUSER
echo "PLEASE INPUT TOUSER NAME: "
read USERNAME
echo "IMPORTING $FROMUSER BACKUP FILE INTO $USERNAME!"
export DUMPFILE=$FROMUSER.dmp
export DIRECTORY=/home/oracle/backup
export LOGFILE=$FROMUSER.log
echo $LOGFILE

$ORACLE_HOME/bin/sqlplus /nolog <<EOF

  connect / as sysdba

  DROP USER $USERNAME CASCADE;

  CREATE USER $USERNAME
  IDENTIFIED BY password
  DEFAULT TABLESPACE USERS
  TEMPORARY TABLESPACE TEMP
  PROFILE DEFAULT
  ACCOUNT UNLOCK;

  GRANT RESOURCE TO $USERNAME;

  GRANT CONNECT TO $USERNAME;

  grant create view to $USERNAME;

  ALTER USER $USERNAME DEFAULT ROLE ALL;

  GRANT UNLIMITED TABLESPACE TO $USERNAME;

  CREATE OR REPLACE DIRECTORY EXPORT AS '$DIRECTORY';

  GRANT READ, WRITE ON DIRECTORY  EXPORT TO SYSTEM;
  GRANT READ, WRITE ON DIRECTORY  EXPORT TO SYSMAN;

EOF
impdp dumpfile=$DUMPFILE remap_schema=$FROMUSER:$USERNAME transform=oid:n,segment_attributes:n userid=system/0racle1 directory=EXPORT logfile=$LOGFILE

